<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Pollito's Albion Map Viewer</title>
<style>
body { font-family:'Segoe UI',sans-serif;background:#111;color:#eee;margin:0 }
h1{text-align:center;margin:20px 0}
#search-container{text-align:center;margin-bottom:20px}
#search-container input{padding:8px 12px;width:260px;border-radius:6px;border:1px solid #555;background:#222;color:#eee}
#maps{display:grid;grid-template-columns:repeat(4,1fr);gap:20px;padding:10px}
.map{border:1px solid #444;border-radius:12px;padding:10px;background:#222;cursor:pointer;transition:.25s;position:relative}
.map:hover{transform:scale(1.05);box-shadow:0 0 15px #e53935}
.map img{max-width:100%;border-radius:6px;margin-bottom:6px}
.map h3{text-align:center;margin:5px 0 10px}
.resources,.chests{display:flex;gap:6px;justify-content:center;flex-wrap:wrap}
.icon-wrapper{position:relative}
.icon-wrapper img{width:22px;height:22px}
.icon-badge{position:absolute;top:-6px;right:-6px;background:#e53935;color:#fff;font-size:10px;
border-radius:999px;padding:0 4px;min-width:16px;height:16px;display:flex;align-items:center;justify-content:center}
#mapModal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.75);
justify-content:center;align-items:center}
#modalBody img:hover{transform:scale(10);box-shadow:0 0 15px}
.modal-content{background:#222;border-radius:12px;padding:20px;max-width:400px;width:90%}
.closeBtn{position:absolute;top:10px;right:15px;cursor:pointer;color:#e53935}
@media(max-width:1200px){#maps{grid-template-columns:repeat(3,1fr)}}
@media(max-width:900px){#maps{grid-template-columns:repeat(2,1fr)}}
@media(max-width:600px){#maps{grid-template-columns:repeat(1,1fr)}}
</style>
</head>

<body>
<h1>Albion Avalon Maps</h1>
<div id="search-container">
<input id="mapSearch" placeholder="Buscar mapa...">
</div>
<div id="maps"></div>

<div id="mapModal">
<div class="modal-content">
<span class="closeBtn">&times;</span>
<div id="modalBody"></div>
</div>
</div>

<script>
const WORKER_URL='https://avalon-maps.pcaternador.workers.dev/';
const ICONS_PATH='./icons/';
let allMaps=[];

const container=document.getElementById('maps');
const searchInput=document.getElementById('mapSearch');
const modal=document.getElementById('mapModal');
const modalBody=document.getElementById('modalBody');

fetch(WORKER_URL).then(r=>r.json()).then(d=>{
	allMaps=Array.isArray(d[0])?d[0]:d;
	renderMaps(allMaps);
});

document.querySelector('.closeBtn').onclick=()=>modal.style.display='none';
window.onclick=e=>{if(e.target===modal)modal.style.display='none';};

function appendBadge(wrapper,count){
	const badge=document.createElement('span');
	badge.className='icon-badge';
	badge.textContent=count;
	wrapper.appendChild(badge);
}

const resourceIcons={
leather:'leather.png',wood:'wood.png',stone:'stone.png',fiber:'fiber.png',mineral:'mineral.png',
blue:'blue.png',green:'green.png',cotton:'cotton.png',ore:'ore.png',rock:'rock.png',
gold:'gold.png',dungeon:'dungeon.png',hire:'hire.png',logs:'logs.png'
};

const nodesMap = {
	leather: 'leather_nodes',
	hide: 'leather_nodes',

	logs: 'wood_nodes',
	wood: 'wood_nodes',

	rock: 'stone_nodes',
	stone: 'stone_nodes',

	cotton: 'fiber_nodes',
	fiber: 'fiber_nodes',

	ore: 'mineral_nodes',
	mineral: 'mineral_nodes'
};


const chestTypes=[
{key:'green_chests',icon:'green.png'},
{key:'blue_chests',icon:'blue.png'},
{key:'gold_chests',icon:'gold.png'},
{key:'dungeons',icon:'dungeon.png'}
];

function renderMaps(maps){
container.innerHTML='';
maps.forEach(map=>{
const div=document.createElement('div');
div.className='map';
const imgSrc=map.image||'';
div.innerHTML=`<h3>${map.map_name} (T${map.tier})</h3><img src="${imgSrc}">`;

const resourcesDiv=document.createElement('div');
resourcesDiv.className='resources';

(map.resources||[]).forEach(r=>{
const key=r.toLowerCase();
if(!resourceIcons[key])return;
const w=document.createElement('div');
w.className='icon-wrapper';
const i=document.createElement('img');
i.src=ICONS_PATH+resourceIcons[key];
w.appendChild(i);

if(nodesMap[key]){
const count=Number(map[nodesMap[key]])||0;
if(count>1)appendBadge(w,count);
}

resourcesDiv.appendChild(w);
});

const chestsDiv=document.createElement('div');
chestsDiv.className='chests';

chestTypes.forEach(c=>{
const count=Number(map[c.key])||0;
if(count<=0)return;
const w=document.createElement('div');
w.className='icon-wrapper';
const i=document.createElement('img');
i.src=ICONS_PATH+c.icon;
w.appendChild(i);
if(count>1)appendBadge(w,count);
chestsDiv.appendChild(w);
});

div.appendChild(resourcesDiv);
div.appendChild(chestsDiv);
container.appendChild(div);

div.onclick=()=>{
const list=Object.entries(nodesMap).map(([k,v])=>{
return `<li>${k}: ${map[v]||0}</li>`;
}).join('');
modalBody.innerHTML=`
<h2>${map.map_name} (T${map.tier})</h2>
<img src="${imgSrc}" style="width:100%;border-radius:6px">
<ul style="text-align:left">${list}</ul>`;
modal.style.display='flex';
};
});
}

searchInput.oninput=()=>{
const q=searchInput.value.toLowerCase();
renderMaps(allMaps.filter(m=>m.map_name.toLowerCase().includes(q)));
};
</script>
</body>
</html>


