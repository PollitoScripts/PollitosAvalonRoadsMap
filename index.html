<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Pollito's Albion Map Viewer</title>
<style>
/* ===================== Estilos originales ===================== */
body { font-family:'Segoe UI',sans-serif;background:#111;color:#eee;margin:0 }
h1{text-align:center;margin:20px 0}
#maps{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;padding:10px}
.map {
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  align-items: center;
  border: 1px solid #444;
  border-radius: 12px;
  padding: 10px;
  background: #222;
  cursor: pointer;
  transition: .25s;
  position: relative;

  /* Quitamos altura fija para usar JS */
  min-height: unset;
  max-height: unset;
  box-sizing: border-box;
}

.map:hover{transform:scale(1.05);box-shadow:0 0 15px #e53935}
.map img {
  max-width: 100%;
  border-radius: 6px;
  margin-bottom: 6px;
  object-fit: contain;
}
.map h3{text-align:center;margin:5px 0 10px}
.resources{display:flex;gap:6px;justify-content:center;flex-wrap:wrap;transition: opacity 0.25s; /* suaviza aparición/desaparición */}
.icon-wrapper{position:relative}
.icon-wrapper img {
  width: 32px;
  height: 32px;
}
.icon-badge{position:absolute;top:-8px;right:-8px;background:#e53935;color:#fff;font-size:11px;
border-radius:999px;padding:0
4px;min-width:18px;height:18px;display:flex;align-items:center;justify-content:center}
#mapModal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.75);justify-content:center;align-items:center}
#modalBody > img:first-of-type:hover{transform:scale(3);box-shadow:0 0 15px}
.modal-content{background:#222;border-radius:12px;padding:20px;max-width:400px;width:90%}
.closeBtn{position:absolute;top:10px;right:15px;cursor:pointer;color:#e53935}
@media(max-width:1200px){#maps{grid-template-columns:repeat(2,1fr)}}
@media(max-width:900px){#maps{grid-template-columns:repeat(1,1fr)}}
@media(max-width:600px){#maps{grid-template-columns:repeat(1,1fr)}}

/* ===================== Barra de búsqueda ===================== */
.grid {
  height: 800px; width: 800px;
  background-image: linear-gradient(to right, #0f0f10 1px, transparent 1px),
                    linear-gradient(to bottom, #0f0f10 1px, transparent 1px);
  background-size: 1rem 1rem;
  background-position: center center;
  position: absolute;
  z-index: -1;
  filter: blur(1px);
}

#poda {
  display: flex; align-items: center; justify-content: center; margin-bottom: 20px;
  position: relative;
}

/* Glow dorado detrás del input */
.white, .border, .darkBorderBg, .glow {
  max-height: 70px; max-width: 314px; height: 100%; width: 100%;
  position: absolute; overflow: hidden; z-index: -1; border-radius: 12px;
  filter: blur(3px);
}

/* Glow adicional dorado */
.glow {
  background: linear-gradient(45deg, #FFD700, #FFC107, #FFB74D);
  opacity: 0.5;
}

/* Input */
.input {
  background-color: #010201;
  border: none;
  width: 301px;
  height: 56px;
  border-radius: 10px;
  color: white;
  padding-inline: 59px;
  font-size: 18px;
}
.input::placeholder { color: #e6c200; } /* dorado claro */
.input:focus { outline: none; }

#main { position: relative; }

/* Máscara sutil de degradado dorado */
#input-mask {
  pointer-events: none;
  width: 100px;
  height: 20px;
  position: absolute;
  background: linear-gradient(90deg, transparent, rgba(255,215,0,0.6));
  top: 18px;
  left: 80px;
}

/* Máscara principal brillante dorada (antes rosa) */
#pink-mask {
  pointer-events: none;
  width: 30px;
  height: 20px;
  position: absolute;
  background: #FFD700; /* dorado sólido */
  top: 10px;
  left: 5px;
  filter: blur(20px);
  opacity: 0.8;
  transition: all 2s;
}

#main:hover > #pink-mask { opacity: 0; }

/* Icono de filtro dorado apagado */
#filter-icon {
  position: absolute;
  top: 8px;
  right: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 2;
  max-height: 40px; max-width: 38px;
  height: 100%; width: 100%;
  isolation: isolate;
  overflow: hidden;
  border-radius: 10px;

  /* Gradiente dorado apagado */
  background: linear-gradient(180deg, #D4AF37, #C9A343, #B88B3B);
  border: 1px solid #D4AF37;
  box-shadow: 0 0 8px rgba(212, 175, 55, 0.4);
}

.filterBorder {
  height: 42px;
  width: 40px;
  position: absolute;
  overflow: hidden;
  top: 7px;
  right: 7px;
  border-radius: 10px;
  border: 1px solid #D4AF37;
  box-shadow: 0 0 6px rgba(212, 175, 55, 0.3);
}

#search-icon { position: absolute; left: 20px; top: 15px; }

/* Gradientes del icono de búsqueda dorados */
#search stop[offset="0%"] { stop-color: #ffe68f; } /* dorado claro */
#search stop[offset="50%"] { stop-color: #FFD700; } /* dorado puro */
#searchl stop[offset="0%"] { stop-color: #FFD700; } /* dorado puro */
#searchl stop[offset="50%"] { stop-color: #e6c200; } /* dorado más oscuro */

/* Ocultar icono de filtro cuando un mapa está abierto */
body.map-open #filter-icon,
body.map-open .filterBorder {
  display: none !important;
}


/* ===================== TOOLTIP DISCORD (Uiverse) ===================== */
.discord-tooltip{
  position:fixed;
  bottom:20px;
  right:20px;
  z-index:9999;
}

.tooltip{
  --color-background:88,101,242;
  --color-text:#fff;
  --size-diameter:5rem;
  --size-shadow:5px;
  align-items:center;
  border:none;
  border-radius:50%;
  cursor:pointer;
  display:flex;
  fill:var(--color-text);
  height:var(--size-diameter);
  justify-content:center;
  position:relative;
  width:var(--size-diameter);
}
.tooltip::before,
.tooltip::after{
  border-radius:inherit;
  height:100%;
  position:absolute;
  width:100%;
}
.tooltip::before{
  background:rgba(var(--color-background),1);
  box-shadow:0 0 var(--size-shadow) #000;
  content:"";
  z-index:1;
}
.tooltip::after{
  background:rgba(0,0,0,.2);
  z-index:2;
}
.tooltip__content{
  height:80%;
  width:80%;
  position:relative;
  z-index:3;
}
.tooltip__label{
  background:radial-gradient(circle at center,transparent 45%,rgb(var(--color-background)) 46%);
  border-radius:100%;
  font-size:.8rem;
  height:100%;
  left:0;
  pointer-events:none;
  position:absolute;
  top:0;
  transition:.3s;
  width:100%;
}
.tooltip__label #circlePath{display:none}
.tooltip:hover .tooltip__label{
  transform:scale(1.3);
}

/* Fuente llamativa y centrada */
.fancy-title {
  font-family: 'Segoe UI', sans-serif;
  font-size: 3rem;
  font-weight: 900;
  text-align: center;
  background: linear-gradient(270deg, #FFD700, #FFC107, #FFB74D, #FFD700);
  background-size: 600% 600%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: gradientShift 6s ease infinite;
  text-shadow: 2px 2px 8px rgba(0,0,0,0.5);
  margin: 20px 0;
}

/* Animación de gradiente */
@keyframes gradientShift {
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}

/* === Colores dorados/neón === */
:root {
  --gold-light: #FFD700;
  --gold-dark: #b8860b;
  --gold-shadow: rgba(255, 215, 0, 0.6);
}

/* ===== Título ===== */
h1 {
  font-family: 'Segoe UI', sans-serif;
  font-size: 3rem;
  text-align: center;
  margin: 20px 0;
  background: linear-gradient(45deg, var(--gold-light), var(--gold-dark));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  text-shadow: 0 0 10px var(--gold-shadow), 0 0 20px var(--gold-shadow);
}

/* ===== Map hover dorado ===== */
.map:hover {
  transform: scale(1.05);
  box-shadow: 0 0 20px var(--gold-shadow);
}

/* ===== Badges doradas ===== */
.icon-badge {
  background: var(--gold-light);
  color: #111;
  font-size: 10px;
  border-radius: 999px;
  padding: 0 4px;
  min-width: 16px;
  height: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 0 6px var(--gold-shadow);
}

/* ===== Discord tooltip dorado borde ===== */
.tooltip {
  --color-background: 88, 101, 242; /* azul original Discord */
  border: 2px solid var(--gold-light);
  box-shadow: 0 0 10px var(--gold-shadow);
}

/* ===== Tooltip hover efecto ===== */
.tooltip:hover::after {
  background: rgba(255, 215, 0, 0.25);
}

/* ===== Opcional: texto de badge o tooltip dorado ===== */
.tooltip-text {
  border: 1px solid var(--gold-light);
  box-shadow: 0 0 8px var(--gold-shadow);
}

/* ============= Contenedor principal: uno a la izquierda y otro a la derecha ============ */
.container {
  display: flex;
  justify-content: space-between; /* Extremos */
  align-items: flex-start;        /* Alinea por arriba */
  width: 100%;
  padding: 2em;
  box-sizing: border-box;
  flex-wrap: wrap;                /* Permite que baje en pantallas muy pequeñas */
  gap: 2em;                       /* Espacio entre foto y tele */
}

/* Evitar que los enlaces se expandan */
.photo_container,
.tv_container {
  display: inline-flex; /* Solo ocupa el tamaño del contenido */
  flex-direction: column;
  text-decoration: none;
  cursor: pointer;
}

/* ===== FOTO 3D ===== */
.parent {
  width: 290px;
  height: 300px;
  perspective: 1200px;
  position: relative;
  margin-left: auto;   
}
.card {
  height: 100%;
  border-radius: 50px;
  background: linear-gradient(135deg, #d4af7f 0%, #b88c4a 100%);
  transition: transform 0.1s ease-out, box-shadow 0.3s ease-in-out;
  transform-style: preserve-3d;
  box-shadow: rgba(0,0,0,0.1) 0px 10px 20px;
  position: relative;
  overflow: hidden;
  display: flex;
  justify-content: center;
  align-items: center;
}
.photo {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 50px;
  transform: translate3d(0, 0, 30px);
  transition: transform 0.1s ease-out, box-shadow 0.3s ease-in-out;
  box-shadow: 0 15px 30px rgba(0,0,0,0.3);
  z-index: 1;
}
.glass {
  position: absolute;
  inset: 8px;
  border-radius: 55px;
  border-top-right-radius: 100%;
  background: linear-gradient(0deg, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0.35) 100%);
  transform: translate3d(0px, 0px, 25px);
  border-left: 1px solid rgba(255,255,255,0.3);
  border-bottom: 1px solid rgba(255,255,255,0.3);
}
.reflection {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border-radius: 50px;
  background: linear-gradient(145deg, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0) 60%);
  pointer-events: none;
  transform: translate3d(0, 0, 60px);
  z-index: 2;
  transition: transform 0.1s ease-out, opacity 0.3s ease-in-out;
}

/* Destellos dorados */
.sparkles {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 3;
  background-image: radial-gradient(circle, rgba(255, 215, 0, 0.5) 0%, rgba(255, 215, 0, 0) 70%);
  background-repeat: repeat;
  background-size: 20% 20%;
  opacity: 0.2;
  transition: transform 0.3s ease, opacity 0.3s ease;
}
/* ===== Recursos dentro del modal (horizontal) ===== */
.resources-container{
  display:flex;
  flex-direction:row;
  gap:6px;
  justify-content:center;
  align-items:center;
  flex-wrap:wrap;
}

</style>
</head>

<body>
<h1 class="fancy-title">Albion Avalon Maps</h1>

<div class="container"> <!-- Contenedor horizontal -->
<!-- ======= Guild Spam Discord ======= -->
<a href="https://discord.gg/JWnJQBqSX6" target="_blank" class="photo_container">
  <div class="parent">
    <div class="card">
     <img src="icons/SMOKINGS.png" alt="Foto 3D" class="photo">
	 <div class="glass"></div>
     <div class="sparkles"></div>
     <div class="reflection"></div>
    </div>
  </div>
</a>
</div>
<!-- ======= Barra Busqueda ======= -->

<div class="grid"></div>
<div id="poda">
  <div class="glow"></div>
  <div class="darkBorderBg"></div>
  <div class="darkBorderBg"></div>
  <div class="darkBorderBg"></div>
  <div class="white"></div>
  <div class="border"></div>

  <div id="main">
    <input id="mapSearch" placeholder="Buscar mapa..." type="text" name="text" class="input" />
    <div id="input-mask"></div>
    <div id="pink-mask"></div>
    <div class="filterBorder"></div>
    <div id="filter-icon">
      <svg preserveAspectRatio="none" height="27" width="27" viewBox="4.8 4.56 14.832 15.408" fill="none">
        <path d="M8.16 6.65002H15.83C16.47 6.65002 16.99 7.17002 16.99 7.81002V9.09002C16.99 9.56002 16.7 10.14 16.41 10.43L13.91 12.64C13.56 12.93 13.33 13.51 13.33 13.98V16.48C13.33 16.83 13.1 17.29 12.81 17.47L12 17.98C11.24 18.45 10.2 17.92 10.2 16.99V13.91C10.2 13.5 9.97 12.98 9.73 12.69L7.52 10.36C7.23 10.08 7 9.55002 7 9.20002V7.87002C7 7.17002 7.52 6.65002 8.16 6.65002Z" stroke="#d6d6e6" stroke-width="1" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path>
      </svg>
    </div>
    <div id="search-icon">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" viewBox="0 0 24 24" stroke-width="2" stroke-linejoin="round" stroke-linecap="round" height="24" fill="none" class="feather feather-search">
        <circle stroke="url(#search)" r="8" cy="11" cx="11"></circle>
        <line stroke="url(#searchl)" y2="16.65" y1="22" x2="16.65" x1="22"></line>
        <defs>
          <linearGradient gradientTransform="rotate(50)" id="search">
            <stop stop-color="#f8e7f8" offset="0%"></stop>
            <stop stop-color="#b6a9b7" offset="50%"></stop>
          </linearGradient>
          <linearGradient id="searchl">
            <stop stop-color="#b6a9b7" offset="0%"></stop>
            <stop stop-color="#837484" offset="50%"></stop>
          </linearGradient>
        </defs>
      </svg>
    </div>
  </div>
</div>

<!-- ======= Contenedor de mapas ======= -->
<div id="maps"></div>

<!-- ======= Modal ======= -->
<div id="mapModal">
  <div class="modal-content">
    <span class="closeBtn">&times;</span>
    <div id="modalBody"></div>
  </div>
</div>

<!-- ===================== DISCORD TOOLTIP ===================== -->
<a href="https://discord.gg/7T3p5anWFQ" target="_blank" class="discord-tooltip">
<button class="tooltip">
  <svg class="tooltip__label" viewBox="0 0 100 100">
    <path id="circlePath" d="M 10 50 A 40 40 0 0 1 90 50"></path>
    <text>
      <textPath href="#circlePath" startOffset="50%">Discord</textPath>
    </text>
  </svg>
  <svg class="tooltip__content" viewBox="0 0 640 512">
    <path d="M524.5 69.8a1.5 1.5 0 0 0 -.8-.7A485.1 485.1 0 0 0 404.1 32a1.8 1.8 0 0 0 -1.9 .9 337.5 337.5 0 0 0 -14.9 30.6 447.8 447.8 0 0 0 -134.4 0 309.5 309.5 0 0 0 -15.1-30.6 1.9 1.9 0 0 0 -1.9-.9A483.7 483.7 0 0 0 116.1 69.1a1.7 1.7 0 0 0 -.8 .7C39.1 183.7 18.2 294.7 28.4 404.4a2 2 0 0 0 .8 1.4A487.7 487.7 0 0 0 176 479.9a1.9 1.9 0 0 0 2.1-.7A348.2 348.2 0 0 0 208.1 430.4a1.9 1.9 0 0 0 -1-2.6 321.2 321.2 0 0 1 -45.9-21.9 1.9 1.9 0 0 1 -.2-3.1c3.1-2.3 6.2-4.7 9.1-7.1a1.8 1.8 0 0 1 1.9-.3c96.2 43.9 200.4 43.9 295.5 0a1.8 1.8 0 0 1 1.9 .2c2.9 2.4 6 4.9 9.1 7.2a1.9 1.9 0 0 1 -.2 3.1 301.4 301.4 0 0 1 -45.9 21.8 1.9 1.9 0 0 0 -1 2.6 391.1 391.1 0 0 0 30 48.8 1.9 1.9 0 0 0 2.1 .7A486 486 0 0 0 610.7 405.7a1.9 1.9 0 0 0 .8-1.4C623.7 277.6 590.9 167.5 524.5 69.8zM222.5 337.6c-29 0-52.8-26.6-52.8-59.2S193.1 219.1 222.5 219.1c29.7 0 53.3 26.8 52.8 59.2C275.3 311 251.9 337.6 222.5 337.6zm195.4 0c-29 0-52.8-26.6-52.8-59.2S388.4 219.1 417.9 219.1c29.7 0 53.3 26.8 52.8 59.2C470.7 311 447.5 337.6 417.9 337.6z"></path>
  </svg>
</button>
</a>

<script>
// ===================== Variables =====================
const WORKER_URL='https://avalon-maps.pcaternador.workers.dev/';
const ICONS_PATH='./icons/';
let allMaps=[];
const container=document.getElementById('maps');
const searchInput=document.getElementById('mapSearch');
const modal=document.getElementById('mapModal');
const modalBody=document.getElementById('modalBody');
const parent = document.querySelector('.parent');
const card = document.querySelector('.card');
const photo = document.querySelector('.photo');
const reflection = document.querySelector('.reflection');
const sparkles = document.querySelector('.sparkles');
const input = document.getElementById("mapSearch");
// ===================== Fetch mapas =====================
fetch(WORKER_URL).then(r=>r.json()).then(d=>{
	allMaps=Array.isArray(d[0])?d[0]:d;
	renderMaps(allMaps);
});

// ===================== Modal =====================
document.querySelector('.closeBtn').onclick = () => {
    modal.style.display = 'none';
    document.body.classList.remove("map-open");
};
window.onclick = e => {
    if (e.target === modal) {
        modal.style.display = 'none';
        document.body.classList.remove("map-open");
    }
};

// ===================== Funciones =====================
function appendBadge(wrapper,count){
	const badge=document.createElement('span');
	badge.className='icon-badge';
	badge.textContent=count;
	wrapper.appendChild(badge);
}

const resourceIcons={
leather:'leather.png',wood:'wood.png',stone:'stone.png',fiber:'fiber.png',mineral:'mineral.png',
blue:'blue.png',green:'green.png',cotton:'cotton.png',ore:'ore.png',rock:'rock.png',
gold:'gold.png',dungeon:'dungeon.png',hire:'hire.png',logs:'logs.png'
};

const nodesMap = {
	leather: 'leather_nodes',
	hide: 'leather_nodes',
	logs: 'wood_nodes',
	wood: 'wood_nodes',
	rock: 'stone_nodes',
	stone: 'stone_nodes',
	cotton: 'fiber_nodes',
	fiber: 'fiber_nodes',
	ore: 'mineral_nodes',
	mineral: 'mineral_nodes'
};

const chestTypes=[
{key:'green_chests',icon:'green.png'},
{key:'blue_chests',icon:'blue.png'},
{key:'gold_chests',icon:'gold.png'},
{key:'dungeons',icon:'dungeon.png'}
];

// ===================== Render mapas =====================
fetch(WORKER_URL)
.then(r => r.json())
.then(d => {
    allMaps = Array.isArray(d[0]) ? d[0] : d;
    renderMaps(allMaps);
});

function renderMaps(maps) {
    container.innerHTML = ''; // limpiar
    maps.forEach(map => {
        const div = document.createElement('div');
        div.className = 'map';

        // ===== Nombre y zona =====
        const titleWrapper = document.createElement('div');
        titleWrapper.style.display = 'flex';
        titleWrapper.style.justifyContent = 'center';
        titleWrapper.style.alignItems = 'center';
        titleWrapper.style.gap = '10px';
        titleWrapper.style.flexWrap = 'wrap';

        const title = document.createElement('h3');
        title.textContent = `${map.map_name} (T${map.tier})`;
        titleWrapper.appendChild(title);

        if (map.zone && map.zone.length) {
            const zoneSpan = document.createElement('span');
            zoneSpan.textContent = map.zone.join(', ');
            zoneSpan.style.fontSize = '0.9em';
            zoneSpan.style.color = '#FFD700';
            zoneSpan.style.fontWeight = 'bold';
            titleWrapper.appendChild(zoneSpan);
        }

        div.appendChild(titleWrapper);

        // ===== Imagen =====
        const img = document.createElement('img');
        img.src = map.image || '';
        div.appendChild(img);

        // ===== Recursos =====
        const resourcesDiv = document.createElement('div');
        resourcesDiv.className = 'resources';
        const iconBySrc = {};

        (map.resources || []).forEach(r => {
            const key = r.toLowerCase();
            if (!resourceIcons[key]) return;
            const src = ICONS_PATH + resourceIcons[key];
            if (!iconBySrc[src]) {
                const w = document.createElement('div');
                w.className = 'icon-wrapper';
                const i = document.createElement('img'); 
                i.src = src;
                w.appendChild(i);
                resourcesDiv.appendChild(w);
                iconBySrc[src] = w;
            }
            if (nodesMap[key]) {
                const count = Number(map[nodesMap[key]]) || 0;
                if (count > 1) appendBadge(iconBySrc[src], count);
            }
        });

        chestTypes.forEach(c => {
            const count = Number(map[c.key]) || 0;
            if (count <= 0) return;
            const src = ICONS_PATH + c.icon;
            if (!iconBySrc[src]) {
                const w = document.createElement('div');
                w.className = 'icon-wrapper';
                const i = document.createElement('img'); 
                i.src = src;
                w.appendChild(i);
                resourcesDiv.appendChild(w);
                iconBySrc[src] = w;
            }
            appendBadge(iconBySrc[src], count);
        });

        div.appendChild(resourcesDiv);
        container.appendChild(div);

        // ===== Modal =====
        div.onclick = () => {
            modalBody.innerHTML = '';

            // Título
            const headerDiv = document.createElement('div');
            headerDiv.style.display = 'flex';
            headerDiv.style.alignItems = 'center';
            headerDiv.style.gap = '10px';
            headerDiv.style.flexWrap = 'wrap';

            const h2 = document.createElement('h2');
            h2.style.margin = '0';
            h2.textContent = `${map.map_name} (T${map.tier})`;
            headerDiv.appendChild(h2);

            if (map.zone && map.zone.length) {
                const zoneSpan = document.createElement('span');
                zoneSpan.textContent = map.zone.join(', ');
                zoneSpan.style.background = '#FFD700';
                zoneSpan.style.color = '#111';
                zoneSpan.style.fontWeight = 'bold';
                zoneSpan.style.padding = '2px 8px';
                zoneSpan.style.borderRadius = '12px';
                zoneSpan.style.fontSize = '0.9rem';
                headerDiv.appendChild(zoneSpan);
            }

            modalBody.appendChild(headerDiv);

            // Imagen
            const modalImg = document.createElement('img');
            modalImg.src = map.image || '';
            modalImg.style.width = '100%';
            modalImg.style.borderRadius = '6px';
            modalImg.style.marginTop = '10px';
            modalBody.appendChild(modalImg);

            // Recursos
            const modalResources = document.createElement('div');
            modalResources.className = 'resources-container';
            const modalIconBySrc = {};

            (map.resources || []).forEach(r => {
                const key = r.toLowerCase();
                if (!resourceIcons[key]) return;
                const src = ICONS_PATH + resourceIcons[key];
                if (!modalIconBySrc[src]) {
                    const w = document.createElement('div');
                    w.className = 'icon-wrapper';
                    const i = document.createElement('img');
                    i.src = src;
                    i.alt = key;
                    w.appendChild(i);
                    modalResources.appendChild(w);
                    modalIconBySrc[src] = w;
                }
                if (nodesMap[key]) {
                    const count = Number(map[nodesMap[key]]) || 0;
                    if (count > 1) appendBadge(modalIconBySrc[src], count);
                }
            });

            chestTypes.forEach(c => {
                const count = Number(map[c.key]) || 0;
                if (count <= 0) return;
                const src = ICONS_PATH + c.icon;
                if (!modalIconBySrc[src]) {
                    const w = document.createElement('div');
                    w.className = 'icon-wrapper';
                    const i = document.createElement('img');
                    i.src = src;
                    w.appendChild(i);
                    modalResources.appendChild(w);
                    modalIconBySrc[src] = w;
                }
                appendBadge(modalIconBySrc[src], count);
            });

            modalBody.appendChild(modalResources);

            // Mostrar modal
            modal.style.display = 'flex';
            document.body.classList.add("map-open");

            // Hover para ocultar recursos
            modalImg.addEventListener('mouseenter', () => {
                modalResources.style.opacity = '0';
                modalResources.style.pointerEvents = 'none';
            });
            modalImg.addEventListener('mouseleave', () => {
                modalResources.style.opacity = '1';
                modalResources.style.pointerEvents = 'auto';
            });
        };
    });

    ajustarAlturasMapas(); // recalcular altura
}

// ===================== Filtro búsqueda =====================
searchInput.addEventListener("input", () => {
    // Reemplaza espacios por guiones
    let value = searchInput.value.replace(/ /g, "-");
    searchInput.value = value;

    // Si termina en "-", no filtramos todavía
    if (value.endsWith("-")) return;

    const query = value.toLowerCase();

    renderMaps(
        allMaps.filter(m =>
            m.map_name
                .toLowerCase()
                .replace(/ /g, "-") // normaliza nombre del mapa
                .includes(query)
        )
    );
});
// ==================== Detecta posicion mouse para foto 3d =============
    parent.addEventListener('mousemove', (e) => {
      const rect = parent.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;

      const centerX = rect.width / 2;
      const centerY = rect.height / 2;

      const rotateX = ((y - centerY) / centerY) * 15;
      const rotateY = ((x - centerX) / centerX) * 15;

      card.style.transform = `rotateX(${-rotateX}deg) rotateY(${rotateY}deg) scale(1.03)`;
      photo.style.transform = `translate3d(0, 0, 70px) scale(1.05)`;
      reflection.style.transform = `translate3d(0, 0, 90px) scale(1.05)`;
      reflection.style.opacity = 0.6;

      const offsetX = (x / rect.width) * 20 - 10;
      const offsetY = (y / rect.height) * 20 - 10;
      sparkles.style.transform = `translate(${offsetX}px, ${offsetY}px)`;
      sparkles.style.opacity = 0.3;
    });

    parent.addEventListener('mouseleave', () => {
      card.style.transform = `rotateX(0deg) rotateY(0deg) scale(1)`;
      photo.style.transform = `translate3d(0, 0, 30px) scale(1)`;
      reflection.style.transform = `translate3d(0, 0, 60px) scale(1)`;
      reflection.style.opacity = 1;
      sparkles.style.transform = `translate(0px, 0px)`;
      sparkles.style.opacity = 0.2;
    });
  </script>
</body>
</html>

